<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeatherHub - Real-time Weather Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        .loading {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .weather-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .weather-card:hover {
            transform: translateY(-5px);
        }
        .favorite-city {
            transition: all 0.3s ease;
        }
        .favorite-city:hover {
            transform: translateY(-3px);
        }
        .bg-weather {
            background-image: url('https://images.unsplash.com/photo-1534088568595-a066f410bcda?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1887&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .bg-overlay {
            background: linear-gradient(to bottom right, rgba(37, 99, 235, 0.8), rgba(59, 130, 246, 0.7));
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            animation: slideIn 0.3s, fadeOut 0.5s 2.5s forwards;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
    </style>
</head>
<body class="bg-weather min-h-screen">
    <div class="bg-overlay min-h-screen">
        <div id="toast-container"></div>
        <nav class="bg-white bg-opacity-10 backdrop-blur-md py-4">
            <div class="container mx-auto px-4 flex justify-between items-center">
                <div class="flex items-center">
                    <i class="bi bi-cloud-sun text-white text-3xl mr-2"></i>
                    <h1 class="text-white text-2xl font-bold">WeatherHub</h1>
                </div>
                <div id="authSection">
                    <div class="flex space-x-4" id="authButtons">
                        <button onclick="toggleAuth('login')" class="bg-white bg-opacity-20 text-white px-6 py-2 rounded-lg shadow hover:bg-opacity-30 transition duration-300">Login</button>
                        <button onclick="toggleAuth('register')" class="bg-white text-blue-600 px-6 py-2 rounded-lg shadow hover:bg-blue-50 transition duration-300">Register</button>
                    </div>
                    <div id="userInfo" class="hidden text-white">
                        <div class="flex items-center gap-2">
                            <i class="bi bi-person-circle text-xl"></i>
                            <span id="username">User</span>
                            <button onclick="logout()" class="ml-4 text-sm bg-white bg-opacity-20 px-3 py-1 rounded hover:bg-opacity-30 transition duration-300">Logout</button>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <div id="app" class="container mx-auto px-4 py-8">
            <!-- Auth Forms -->
            <div id="authForms" class="hidden mb-8">
                <div class="max-w-md mx-auto bg-white rounded-xl shadow-lg p-6 transform transition-all duration-300">
                    <div class="flex justify-between items-center mb-4">
                        <h2 id="authTitle" class="text-2xl font-bold text-gray-800">Login</h2>
                        <button onclick="closeAuthForm()" class="text-gray-500 hover:text-gray-700">
                            <i class="bi bi-x-lg"></i>
                        </button>
                    </div>
                    <form id="authForm" onsubmit="handleAuth(event)">
                        <div id="nameField" class="hidden mb-4">
                            <label class="block text-gray-700 mb-1">Name</label>
                            <input type="text" placeholder="Your name" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 mb-1">Email</label>
                            <input type="email" placeholder="Your email" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <div class="mb-6">
                            <label class="block text-gray-700 mb-1">Password</label>
                            <input type="password" placeholder="Your password" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition duration-300">
                            <span id="authButtonText">Login</span>
                        </button>
                    </form>
                </div>
            </div>

            <!-- Weather Search -->
            <div class="mb-8">
                <div class="max-w-xl mx-auto">
                    <div class="flex gap-2">
                        <div class="relative flex-1">
                            <input 
                                type="text" 
                                id="citySearch" 
                                placeholder="Enter city name" 
                                class="w-full p-3 pl-10 rounded-lg shadow focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <i class="bi bi-geo-alt absolute left-3 top-3 text-gray-500"></i>
                        </div>
                        <button onclick="searchWeather()" id="searchButton" class="bg-white text-blue-600 px-6 py-2 rounded-lg shadow hover:bg-blue-50 transition duration-300">
                            <i class="bi bi-search"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Loader -->
            <div id="loader" class="hidden">
                <div class="flex justify-center items-center my-12">
                    <i class="bi bi-arrow-repeat text-white text-5xl loading"></i>
                </div>
            </div>

            <!-- Current Weather -->
            <div id="currentWeather" class="hidden mb-8 transition-all duration-300">
                <div class="max-w-2xl mx-auto weather-card rounded-xl p-6 text-white">
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="flex items-center mb-2">
                                <h2 id="cityName" class="text-3xl font-bold">City Name</h2>
                                <button id="favoriteBtn" onclick="toggleFavorite()" class="ml-2 text-yellow-300 hover:text-yellow-500 transition-colors">
                                    <i class="bi bi-star"></i>
                                </button>
                            </div>
                            <p id="currentDate" class="text-lg opacity-80 mb-4">Date</p>
                            <div class="flex items-center gap-2">
                                <p id="currentTemp" class="text-5xl font-bold">--째C</p>
                                <div class="text-xl ml-2">
                                    <p id="highTemp" class="flex items-center"><i class="bi bi-arrow-up text-red-300 mr-1"></i>--째</p>
                                    <p id="lowTemp" class="flex items-center"><i class="bi bi-arrow-down text-blue-300 mr-1"></i>--째</p>
                                </div>
                            </div>
                            <p id="feelsLike" class="text-lg mt-1">Feels like: --째C</p>
                        </div>
                        <div class="text-right flex flex-col items-end">
                            <i id="weatherIcon" class="bi bi-cloud text-7xl mb-2"></i>
                            <p id="weatherDesc" class="text-xl capitalize">Weather Description</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8">
                        <div class="text-center p-3 bg-white bg-opacity-10 rounded-lg">
                            <i class="bi bi-moisture text-xl"></i>
                            <p>Humidity</p>
                            <p id="humidity" class="font-bold text-lg">--%</p>
                        </div>
                        <div class="text-center p-3 bg-white bg-opacity-10 rounded-lg">
                            <i class="bi bi-wind text-xl"></i>
                            <p>Wind Speed</p>
                            <p id="windSpeed" class="font-bold text-lg">-- m/s</p>
                        </div>
                        <div class="text-center p-3 bg-white bg-opacity-10 rounded-lg">
                            <i class="bi bi-flower1 text-xl"></i>
                            <p>Pressure</p>
                            <p id="pressure" class="font-bold text-lg">-- hPa</p>
                        </div>
                        <div class="text-center p-3 bg-white bg-opacity-10 rounded-lg">
                            <i class="bi bi-eye text-xl"></i>
                            <p>Visibility</p>
                            <p id="visibility" class="font-bold text-lg">-- km</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Weather Forecast -->
            <div id="forecastSection" class="hidden mb-8 transition-all duration-300">
                <h2 class="text-2xl font-bold text-white mb-4 ml-2">7-Day Forecast</h2>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-7 gap-3" id="forecastContainer">
                    <!-- Forecast cards will be dynamically generated -->
                </div>
            </div>

            <!-- Weather Chart -->
            <div id="chartSection" class="hidden mb-8 transition-all duration-300">
                <div class="max-w-4xl mx-auto bg-white bg-opacity-90 rounded-xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold text-gray-800">Temperature Forecast</h2>
                        <div class="flex space-x-2">
                            <button onclick="setChartType('temp')" class="px-3 py-1 bg-blue-100 text-blue-600 rounded-lg text-sm hover:bg-blue-200">Temperature</button>
                            <button onclick="setChartType('humidity')" class="px-3 py-1 bg-gray-100 text-gray-600 rounded-lg text-sm hover:bg-gray-200">Humidity</button>
                        </div>
                    </div>
                    <canvas id="weatherChart" height="250"></canvas>
                </div>
            </div>

            <!-- Favorites Section -->
            <div id="favoritesSection" class="hidden transition-all duration-300">
                <h2 class="text-2xl font-bold text-white mb-4 ml-2">Favorite Locations</h2>
                <div id="favoritesList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    <!-- Favorite cities will be populated here -->
                </div>
                <div id="noFavorites" class="text-center my-8 text-white opacity-80">
                    <i class="bi bi-heart text-4xl mb-2"></i>
                    <p class="text-lg">You haven't added any favorite cities yet.</p>
                    <p>Search for a city and click the star icon to add it to your favorites.</p>
                </div>
            </div>
        </div>

        <footer class="bg-white bg-opacity-10 py-4 mt-8">
            <div class="container mx-auto px-4 text-center text-white">
                <p>짤 2023 WeatherHub | Powered by OpenWeather API</p>
                <div class="flex justify-center gap-4 mt-2">
                    <a href="#" class="hover:text-blue-200"><i class="bi bi-github"></i></a>
                    <a href="#" class="hover:text-blue-200"><i class="bi bi-twitter"></i></a>
                    <a href="#" class="hover:text-blue-200"><i class="bi bi-linkedin"></i></a>
                </div>
            </div>
        </footer>
    </div>

    <script>
        let chart = null;
        const API_KEY = '15huIlRqfffmNxO3Mo8RhwKrhCq2';
        let isLoggedIn = false;
        let currentCity = '';
        let favorites = [];
        let currentWeatherData = null;
        let currentChartType = 'temp';
        const appSlug = 'weather-app-123456';
        let userId = 'guest-user';

        // Show toast notifications
        function showToast(message, type = 'success') {
            const toastContainer = document.getElementById('toast-container');
            
            const toast = document.createElement('div');
            toast.className = `toast p-4 rounded-lg shadow-lg ${type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white`;
            toast.textContent = message;
            
            toastContainer.appendChild(toast);
            
            // Remove toast after 3 seconds
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Auth functions
        function toggleAuth(type) {
            const authForms = document.getElementById('authForms');
            const authTitle = document.getElementById('authTitle');
            const authButtonText = document.getElementById('authButtonText');
            const nameField = document.getElementById('nameField');
            
            authForms.classList.remove('hidden');
            
            if (type === 'login') {
                authTitle.textContent = 'Login';
                authButtonText.textContent = 'Login';
                nameField.classList.add('hidden');
            } else {
                authTitle.textContent = 'Register';
                authButtonText.textContent = 'Register';
                nameField.classList.remove('hidden');
            }
        }

        function closeAuthForm() {
            document.getElementById('authForms').classList.add('hidden');
        }

        async function handleAuth(event) {
            event.preventDefault();
            
            // Simulate authentication
            isLoggedIn = true;
            userId = `user-${Date.now()}`;
            
            document.getElementById('authForms').classList.add('hidden');
            document.getElementById('authButtons').classList.add('hidden');
            
            const userInfo = document.getElementById('userInfo');
            userInfo.classList.remove('hidden');
            document.getElementById('username').textContent = event.target.elements[0].value || 'User';
            
            document.getElementById('favoritesSection').classList.remove('hidden');
            
            // Load user favorites
            loadFavorites();
            
            showToast('You are now logged in!');
        }

        function logout() {
            isLoggedIn = false;
            userId = 'guest-user';
            
            document.getElementById('userInfo').classList.add('hidden');
            document.getElementById('authButtons').classList.remove('hidden');
            document.getElementById('favoritesSection').classList.add('hidden');
            
            favorites = [];
            
            showToast('You have been logged out');
        }

        // Weather functions
        async function searchWeather() {
            const city = document.getElementById('citySearch').value.trim();
            if (!city) return;

            // Show loading state
            document.getElementById('loader').classList.remove('hidden');
            document.getElementById('currentWeather').classList.add('hidden');
            document.getElementById('chartSection').classList.add('hidden');
            document.getElementById('forecastSection').classList.add('hidden');

            try {
                const weather = await fetchWeatherData(city);
                currentWeatherData = weather;
                currentCity = city;
                
                updateWeatherUI(weather);
                updateWeatherChart(weather);
                updateForecastUI(weather);
                
                // Save search to history if logged in
                if (isLoggedIn) {
                    saveSearchToHistory(city);
                }
                
                // Update favorite button
                const favoriteBtn = document.getElementById('favoriteBtn');
                if (favorites.includes(city)) {
                    favoriteBtn.innerHTML = '<i class="bi bi-star-fill"></i>';
                } else {
                    favoriteBtn.innerHTML = '<i class="bi bi-star"></i>';
                }
                
            } catch (error) {
                console.error('Error fetching weather:', error);
                showToast('Failed to fetch weather data. Please check the city name and try again.', 'error');
            } finally {
                document.getElementById('loader').classList.add('hidden');
            }
        }

        async function fetchWeatherData(city) {
            // For demo purposes we'll use randomized data
            // In a real app, this would call the OpenWeatherMap API
            
            const today = new Date();
            const forecast = Array(7).fill().map((_, i) => {
                const day = new Date(today);
                day.setDate(today.getDate() + i);
                
                // Generate random but realistic weather patterns
                const baseTemp = 20 + Math.sin(i * 0.5) * 8;
                const tempHigh = Math.round(baseTemp + Math.random() * 5);
                const tempLow = Math.round(baseTemp - Math.random() * 5);
                
                return {
                    day: day.toLocaleDateString('en-US', {weekday: 'short'}),
                    date: day.toLocaleDateString('en-US', {month: 'short', day: 'numeric'}),
                    temp: Math.round((tempHigh + tempLow) / 2),
                    tempHigh,
                    tempLow,
                    humidity: Math.round(40 + Math.random() * 40),
                    description: ['Clear', 'Partly cloudy', 'Cloudy', 'Light rain', 'Sunny'][Math.floor(Math.random() * 5)],
                    icon: ['bi-sun', 'bi-cloud-sun', 'bi-cloud', 'bi-cloud-drizzle', 'bi-brightness-high'][Math.floor(Math.random() * 5)]
                };
            });
            
            return {
                city: city,
                date: today.toLocaleDateString('en-US', {weekday: 'long', month: 'long', day: 'numeric'}),
                temp: forecast[0].temp,
                tempHigh: forecast[0].tempHigh,
                tempLow: forecast[0].tempLow,
                feelsLike: Math.round(forecast[0].temp - 2 + Math.random() * 4),
                humidity: forecast[0].humidity,
                windSpeed: Math.round(5 + Math.random() * 20),
                pressure: Math.round(1000 + Math.random() * 100),
                visibility: Math.round(5 + Math.random() * 5),
                description: forecast[0].description,
                icon: forecast[0].icon,
                forecast: forecast
            };
        }

        function updateWeatherUI(weather) {
            document.getElementById('currentWeather').classList.remove('hidden');
            
            document.getElementById('cityName').textContent = weather.city;
            document.getElementById('currentDate').textContent = weather.date;
            document.getElementById('currentTemp').textContent = `${weather.temp}째C`;
            document.getElementById('highTemp').innerHTML = `<i class="bi bi-arrow-up text-red-300 mr-1"></i>${weather.tempHigh}째`;
            document.getElementById('lowTemp').innerHTML = `<i class="bi bi-arrow-down text-blue-300 mr-1"></i>${weather.tempLow}째`;
            document.getElementById('feelsLike').textContent = `Feels like: ${weather.feelsLike}째C`;
            document.getElementById('humidity').textContent = `${weather.humidity}%`;
            document.getElementById('windSpeed').textContent = `${weather.windSpeed} km/h`;
            document.getElementById('pressure').textContent = `${weather.pressure} hPa`;
            document.getElementById('visibility').textContent = `${weather.visibility} km`;
            document.getElementById('weatherDesc').textContent = weather.description;
            
            // Set weather icon
            document.getElementById('weatherIcon').className = `bi ${weather.icon} text-7xl`;
        }

        function updateForecastUI(weather) {
            document.getElementById('forecastSection').classList.remove('hidden');
            
            const forecastContainer = document.getElementById('forecastContainer');
            forecastContainer.innerHTML = '';
            
            weather.forecast.forEach((day, index) => {
                const dayCard = document.createElement('div');
                dayCard.className = 'weather-card text-white p-4 rounded-lg text-center';
                
                dayCard.innerHTML = `
                    <p class="font-bold">${day.day}</p>
                    <p class="text-sm opacity-80">${day.date}</p>
                    <i class="bi ${day.icon} text-3xl my-2"></i>
                    <p class="text-sm">${day.description}</p>
                    <div class="flex justify-center gap-2 mt-2">
                        <p class="text-red-300">${day.tempHigh}째</p>
                        <p class="text-blue-300">${day.tempLow}째</p>
                    </div>
                `;
                
                forecastContainer.appendChild(dayCard);
            });
        }

        function updateWeatherChart(weather) {
            document.getElementById('chartSection').classList.remove('hidden');
            
            if (chart) {
                chart.destroy();
            }
            
            const ctx = document.getElementById('weatherChart').getContext('2d');
            const labels = weather.forecast.map(f => f.day);
            const data = currentChartType === 'temp' 
                ? weather.forecast.map(f => f.temp)
                : weather.forecast.map(f => f.humidity);
            
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: currentChartType === 'temp' ? 'Temperature (째C)' : 'Humidity (%)',
                        data: data,
                        borderColor: currentChartType === 'temp' ? 'rgba(255, 99, 132, 1)' : 'rgba(54, 162, 235, 1)',
                        backgroundColor: currentChartType === 'temp' ? 'rgba(255, 99, 132, 0.2)' : 'rgba(54, 162, 235, 0.2)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 4,
                        pointBackgroundColor: currentChartType === 'temp' ? 'rgba(255, 99, 132, 1)' : 'rgba(54, 162, 235, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(0,0,0,0.7)',
                            padding: 10,
                            cornerRadius: 4
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: currentChartType === 'humidity',
                            title: {
                                display: true,
                                text: currentChartType === 'temp' ? 'Temperature (째C)' : 'Humidity (%)'
                            }
                        }
                    }
                }
            });
        }

        function setChartType(type) {
            currentChartType = type;
            if (currentWeatherData) {
                updateWeatherChart(currentWeatherData);
            }
        }

        // Favorites functions
        async function loadFavorites() {
            if (!isLoggedIn) return;
            
            try {
                // In a real app, this would fetch from MongoDB
                // For demo, we'll use a simulated response
                const response = await fetch('https://r0c8kgwocscg8gsokogwwsw4.zetaverse.one/mongodb', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        appSlug: appSlug,
                        action: 'read',
                        collection: 'favorites',
                        conditions: { userId: userId }
                    })
                });
                
                const data = await response.json();
                
                if (data.success && data.result.length > 0) {
                    favorites = data.result[0].cities || [];
                    updateFavoritesList();
                } else {
                    // Create a new favorites document for this user
                    await fetch('https://r0c8kgwocscg8gsokogwwsw4.zetaverse.one/mongodb', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${API_KEY}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            appSlug: appSlug,
                            action: 'create',
                            collection: 'favorites',
                            data: {
                                userId: userId,
                                cities: []
                            }
                        })
                    });
                    
                    favorites = [];
                }
                
                updateFavoritesList();
            } catch (error) {
                console.error('Error loading favorites:', error);
                showToast('Failed to load favorites', 'error');
            }
        }

        async function toggleFavorite() {
            if (!isLoggedIn) {
                showToast('Please login to save favorites', 'error');
                return;
            }
            
            if (!currentCity) return;
            
            const isFavorite = favorites.includes(currentCity);
            
            if (isFavorite) {
                // Remove from favorites
                favorites = favorites.filter(city => city !== currentCity);
            } else {
                // Add to favorites
                favorites.push(currentCity);
            }
            
            // Update UI
            const favoriteBtn = document.getElementById('favoriteBtn');
            favoriteBtn.innerHTML = isFavorite ? '<i class="bi bi-star"></i>' : '<i class="bi bi-star-fill"></i>';
            
            // Save to database
            try {
                await fetch('https://r0c8kgwocscg8gsokogwwsw4.zetaverse.one/mongodb', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        appSlug: appSlug,
                        action: 'update',
                        collection: 'favorites',
                        conditions: { userId: userId },
                        data: { cities: favorites }
                    })
                });
                
                updateFavoritesList();
                
                showToast(isFavorite ? 'Removed from favorites' : 'Added to favorites');
            } catch (error) {
                console.error('Error updating favorites:', error);
                showToast('Failed to update favorites', 'error');
            }
        }

        function updateFavoritesList() {
            const favoritesList = document.getElementById('favoritesList');
            const noFavorites = document.getElementById('noFavorites');
            
            favoritesList.innerHTML = '';
            
            if (favorites.length === 0) {
                noFavorites.classList.remove('hidden');
                favoritesList.classList.add('hidden');
                return;
            }
            
            noFavorites.classList.add('hidden');
            favoritesList.classList.remove('hidden');
            
            favorites.forEach(city => {
                const cityCard = document.createElement('div');
                cityCard.className = 'favorite-city bg-white bg-opacity-10 backdrop-filter backdrop-blur-md p-4 rounded-lg text-white';
                
                cityCard.innerHTML = `
                    <div class="flex justify-between items-center">
                        <h3 class="text-xl font-semibold">${city}</h3>
                        <button onclick="removeFavorite('${city}')" class="text-red-300 hover:text-red-500">
                            <i class="bi bi-x-circle"></i>
                        </button>
                    </div>
                    <button onclick="loadFavoriteWeather('${city}')" class="mt-3 w-full bg-white bg-opacity-20 py-2 rounded hover:bg-opacity-30">
                        View Weather
                    </button>
                `;
                
                favoritesList.appendChild(cityCard);
            });
        }

        async function loadFavoriteWeather(city) {
            document.getElementById('citySearch').value = city;
            await searchWeather();
        }

        async function removeFavorite(city) {
            if (!isLoggedIn) return;
            
            favorites = favorites.filter(c => c !== city);
            
            // Update database
            try {
                await fetch('https://r0c8kgwocscg8gsokogwwsw4.zetaverse.one/mongodb', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        appSlug: appSlug,
                        action: 'update',
                        collection: 'favorites',
                        conditions: { userId: userId },
                        data: { cities: favorites }
                    })
                });
                
                updateFavoritesList();
                
                // Update favorite button if current city is the one removed
                if (currentCity === city) {
                    document.getElementById('favoriteBtn').innerHTML = '<i class="bi bi-star"></i>';
                }
                
                showToast('Removed from favorites');
            } catch (error) {
                console.error('Error removing favorite:', error);
                showToast('Failed to remove favorite', 'error');
            }
        }

        async function saveSearchToHistory(city) {
            try {
                // Save search history to MongoDB
                await fetch('https://r0c8kgwocscg8gsokogwwsw4.zetaverse.one/mongodb', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        appSlug: appSlug,
                        action: 'create',
                        collection: 'searchHistory',
                        data: {
                            userId: userId,
                            city: city,
                            searchedAt: new Date().toISOString()
                        }
                    })
                });
            } catch (error) {
                console.error('Error saving search history:', error);
            }
        }

        // Add Enter key support for search
        document.getElementById('citySearch').addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                searchWeather();
            }
        });

        // Initialize with a default city
        document.addEventListener('DOMContentLoaded', async () => {
            document.getElementById('citySearch').value = 'New York';
            await searchWeather();
        });
    </script>
<script>document.body.addEventListener('wheel', e => { if (!e.ctrlKey) return; e.preventDefault(); return }, { passive: false })</script>
	</body>
</html>